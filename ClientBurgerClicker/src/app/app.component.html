<div class="app">
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="branding">
        <span class="logo">üçî</span>
        <h1>Burger Clicker</h1>
      </div>
      <span class="user-name" style="display: flex; align-items: center; gap: 0.5em">
        {{ name }}
        <button
          class="btn dark"
          style="padding: 2px 10px; font-size: 0.9em; margin-left: 0.5em"
          (click)="logout()"
          title="Cerrar sesi√≥n"
        >
          Logout
        </button>
      </span>
    </header>

    <div class="layout">
      <section class="panel">
        <div class="game">
          <button #burgerBtn class="burger" (click)="onClick($event)" aria-label="Sumar hamburguesa">
            <canvas style="height: 250px; width: 250px" id="burger_canvas"></canvas>
            <span class="badge">CPS: {{ cps.toFixed(2) }}</span>
          </button>

          <div class="stats">
            <div class="stat">
              <div class="label">Clicks</div>
              <div class="value">
                {{ ['connecting', 'fail'].includes(this.ws.wsConnected) ? '?' : fmt(bestScore) }}
              </div>
            </div>
          </div>
        </div>

        <!-- Pops flotantes -->
        @for (p of pops; track $index) {
          <span class="pop" [style.left.px]="p.x" [style.top.px]="p.y">
            {{ p.value }}
          </span>
        }
      </section>

      <!-- Scoreboard -->
      <aside class="scoreboard">
        <div
          style="display: flex; align-items: center; justify-content: space-between; width: 100%; margin-bottom: 1rem"
        >
          <h2>Scoreboard</h2>

          @switch (this.ws.wsConnected) {
            @case ('connecting') {
              <span class="wss-connecting" style="display: flex; align-items: center; justify-content: center">
                <svg
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  style="animation: spin 1s linear infinite"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <circle cx="12" cy="12" r="10" stroke="#a16207" stroke-width="4" opacity="0.3" />
                  <path d="M22 12a10 10 0 0 1-10 10" stroke="#a16207" stroke-width="4" stroke-linecap="round" />
                </svg>
              </span>
            }
            @case ('connected') {
              <span class="wss-connected" style="display: flex; align-items: center; justify-content: center">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path
                    d="M6 12l4 4 8-8"
                    stroke="#166534"
                    stroke-width="3"
                    fill="none"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </span>
            }
            @case ('fail') {
              <span class="wss-fail" style="display: flex; align-items: center; justify-content: center">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6 6l12 12M6 18L18 6" stroke="#991b1b" stroke-width="3" stroke-linecap="round" />
                </svg>
              </span>
            }
          }
        </div>
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Jugador</th>
              <th class="right">Puntaje</th>
            </tr>
          </thead>
          <tbody>
            @if (scores.length === 0) {
              <tr>
                @if (this.ws.wsConnected === 'fail') {
                  <td colspan="4" class="empty">Hubo un error al conectarse al servidor de puntajes.</td>
                } @else if (this.ws.wsConnected === 'connecting') {
                  <td colspan="4" class="empty">Conectando al servidor de puntajes...</td>
                } @else {
                  <td colspan="4" class="empty">No hay puntajes a√∫n. ¬°S√© el primero!</td>
                }
              </tr>
            } @else {
              @for (row of scores; track row.id; let idx = $index) {
                <tr style="text-align: center">
                  <td class="muted">{{ idx + 1 }}</td>
                  <td class="truncate" [title]="row.name">{{ row.name }}</td>
                  <td class="right">{{ fmt(row.score) }}</td>
                </tr>
              }
            }
          </tbody>
        </table>
        <div style="display: flex; justify-content: center; margin-top: 1rem">
          @if (this.ws.wsConnected === 'fail') {
            <button class="btn dark" (click)="this.ws.connect()" style="margin-top: 0.5em">Reintentar conexi√≥n</button>
          }
        </div>
      </aside>
    </div>
  </div>
</div>

@if (firstTime) {
  <div class="blur-bg">
    <div>
      <h1 class="mb-4 text-4xl font-bold">¬°Bienvenido a Burger Clicker!</h1>
      <p class="mb-4">Parece que es tu primera vez aqu√≠.</p>
      <p class="mb-4">Ingresa tu nombre para comenzar a jugar.</p>

      <input
        type="text"
        placeholder="Tu nombre"
        class="mb-4 rounded border border-gray-300 px-4 py-2"
        [(ngModel)]="name"
      />

      <button class="btn bg-blue-500 text-white" (click)="this.persist()" [disabled]="this.name.length < 1">
        Comenzar a jugar
      </button>
    </div>
  </div>
}
